# ============================================================================
# NOTIFICATION SERVICE - Environment Configuration
# ============================================================================
# This file contains all environment variables for the notification service.
# Copy this file to .env and update with your actual values.
#
# Required variables are marked with [REQUIRED]
# Optional variables are marked with [OPTIONAL]
# ============================================================================

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================

# [REQUIRED] Runtime environment
# Values: development | production | test
NODE_ENV=development

# [REQUIRED] Service port number
PORT=4005

# [OPTIONAL] Service version
SERVICE_VERSION=1.0.0

# ============================================================================
# FRONTEND URL
# ============================================================================

# [REQUIRED] Frontend application URL (for email links)
# Production: https://applyforus.com
# Local Dev: http://localhost:3000
FRONTEND_URL=https://applyforus.com

# --- Local Development Override (use in .env.local) ---
# FRONTEND_URL=http://localhost:3000

# ============================================================================
# DATABASE - PostgreSQL
# ============================================================================
# Production: Azure Database for PostgreSQL (SSL required)
# Local Dev: Use localhost:5432 or Docker Compose
# ============================================================================

# [REQUIRED] Database host
DB_HOST=applyforus-postgres.postgres.database.azure.com

# [REQUIRED] Database port
DB_PORT=5432

# [REQUIRED] Database username
DB_USERNAME=applyforusadmin@applyforus-postgres

# [REQUIRED] Database password - CHANGE IN PRODUCTION
DB_PASSWORD=<your-db-password-here>

# [REQUIRED] Database name
DB_DATABASE=notification_service

# [REQUIRED] Enable SSL for database connection (always true in production)
DB_SSL=true

# [OPTIONAL] Path to SSL CA certificate
DB_SSL_CA_CERT=

# --- Local Development Override (use in .env.local) ---
# DB_HOST=localhost
# DB_PORT=5432
# DB_USERNAME=postgres
# DB_PASSWORD=postgres
# DB_SSL=false

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
# Production: Azure Cache for Redis (SSL/TLS on port 6380)
# Local Dev: Use localhost:6379 or Docker Compose
# Used for: Bull job queues, notification batching
# ============================================================================

# [REQUIRED] Redis host
REDIS_HOST=applyforus-redis.redis.cache.windows.net

# [REQUIRED] Redis port (6380 for Azure SSL, 6379 for local)
REDIS_PORT=6380

# [REQUIRED] Redis password/access key
REDIS_PASSWORD=<your-redis-access-key-here>

# [OPTIONAL] Redis database number (0-15)
REDIS_DB=0

# [REQUIRED] Enable TLS for Redis connection
REDIS_TLS=true

# [OPTIONAL] Enable SSL (alias for TLS)
REDIS_SSL=true

# --- Local Development Override (use in .env.local) ---
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_TLS=false

# ============================================================================
# EMAIL - SMTP CONFIGURATION
# ============================================================================
# Development: Use MailHog (localhost:1025) for testing
# Production: Use SendGrid, Mailgun, or other providers
# See ops/docs/environment-setup.md for detailed setup instructions
# ============================================================================

# [REQUIRED] SMTP server host
# Development: localhost (MailHog)
# SendGrid: smtp.sendgrid.net
# Mailgun: smtp.mailgun.org
SMTP_HOST=localhost

# [REQUIRED] SMTP server port
# MailHog: 1025
# Standard TLS: 587
SMTP_PORT=1025

# [OPTIONAL] Use secure connection (TLS)
SMTP_SECURE=false

# [OPTIONAL] SMTP username (not needed for MailHog)
SMTP_USER=

# [OPTIONAL] SMTP password (not needed for MailHog)
SMTP_PASSWORD=

# --- Production Override ---
# SMTP_HOST=smtp.sendgrid.net
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=apikey
# SMTP_PASSWORD=<your-sendgrid-api-key>

# ============================================================================
# EMAIL SETTINGS
# ============================================================================

# [REQUIRED] Default from email address
EMAIL_FROM=noreply@jobapply.com

# [OPTIONAL] Default from name
EMAIL_FROM_NAME=Job Apply Platform

# --- Production Override ---
# EMAIL_FROM=noreply@applyforus.com
# EMAIL_FROM_NAME=ApplyForUs

# ============================================================================
# PUSH NOTIFICATIONS - Firebase Cloud Messaging (FCM)
# ============================================================================
# Used for: Android and Web push notifications
# Obtain from: Firebase Console > Project Settings > Service Accounts
# See ops/docs/environment-setup.md for detailed setup instructions
# ============================================================================

# [REQUIRED for Push] FCM service account JSON
# Option 1: Inline JSON string
FCM_SERVICE_ACCOUNT='{"type":"service_account","project_id":"your-project-id",...}'

# Option 2: Path to service account JSON file (for local development)
# FCM_SERVICE_ACCOUNT_PATH=/path/to/firebase-service-account.json

# ============================================================================
# PUSH NOTIFICATIONS - Apple Push Notification Service (APNs)
# ============================================================================
# Used for: iOS push notifications
# Obtain from: Apple Developer Portal > Certificates, Identifiers & Profiles
# See ops/docs/environment-setup.md for detailed setup instructions
# ============================================================================

# [REQUIRED for iOS] APNs Key ID
# 10-character string from Apple Developer Portal
APNS_KEY_ID=YOUR_KEY_ID

# [REQUIRED for iOS] APNs Team ID
# 10-character string from Apple Developer Portal
APNS_TEAM_ID=YOUR_TEAM_ID

# [REQUIRED for iOS] APNs Private Key
# Contents of the .p8 file (replace newlines with \n)
APNS_KEY='-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----'

# [OPTIONAL] APNs environment
# true = production (App Store apps)
# false = development/sandbox (TestFlight, development builds)
APNS_PRODUCTION=false

# ============================================================================
# SENDGRID (Optional - Alternative to SMTP)
# ============================================================================
# Use SendGrid API for transactional emails
# Obtain from: https://app.sendgrid.com/settings/api_keys
# ============================================================================

# [OPTIONAL] SendGrid API key
# SENDGRID_API_KEY=SG.xxx

# [OPTIONAL] SendGrid from email
# SENDGRID_FROM_EMAIL=noreply@applyforus.com

# [OPTIONAL] SendGrid from name
# SENDGRID_FROM_NAME=ApplyForUs

# ============================================================================
# LOGGING
# ============================================================================

# [OPTIONAL] Log level (error, warn, info, debug)
LOG_LEVEL=info

# ============================================================================
# MONITORING - Azure Application Insights
# ============================================================================

# [OPTIONAL] Application Insights connection string
APPLICATIONINSIGHTS_CONNECTION_STRING=

# [OPTIONAL] Application Insights instrumentation key (legacy)
APPLICATIONINSIGHTS_INSTRUMENTATION_KEY=

# ============================================================================
# METRICS
# ============================================================================

# [OPTIONAL] Enable Prometheus metrics endpoint
ENABLE_METRICS=true

# [OPTIONAL] Metrics endpoint port
METRICS_PORT=9090

# ============================================================================
# EXTERNAL SERVICES
# ============================================================================
# Production: Use Kubernetes internal DNS
# Local Dev: Use localhost URLs
# ============================================================================

# [OPTIONAL] Auth service URL for token validation
# AUTH_SERVICE_URL=http://auth-service.applyforus.svc.cluster.local:8001

# [OPTIONAL] User service URL for user data
# USER_SERVICE_URL=http://user-service.applyforus.svc.cluster.local:8002

# --- Local Development Override ---
# AUTH_SERVICE_URL=http://localhost:8001
# USER_SERVICE_URL=http://localhost:8002

# ============================================================================
# WEBHOOK AUTHENTICATION
# ============================================================================
# Secrets for verifying incoming webhooks from external services
# Generate secure secrets using: openssl rand -hex 32
# ============================================================================

# [REQUIRED for webhooks] Global webhook signing secret for signature verification
# Used to verify incoming webhooks from external services
WEBHOOK_SECRET=<generate-using-openssl-rand-hex-32>

# [OPTIONAL] Stripe webhook signing secret
# Obtain from: Stripe Dashboard > Developers > Webhooks > Signing secret
STRIPE_WEBHOOK_SECRET=whsec_xxx

# [OPTIONAL] SendGrid webhook signing secret
# Obtain from: SendGrid > Settings > Mail Settings > Event Webhook
SENDGRID_WEBHOOK_SECRET=<your-sendgrid-webhook-secret>

# [OPTIONAL] Twilio webhook auth token
# Used to verify Twilio SMS/Voice webhooks
TWILIO_WEBHOOK_AUTH_TOKEN=<your-twilio-auth-token>

# [OPTIONAL] Webhook signature tolerance in seconds (default: 300 = 5 minutes)
# Requests with timestamps older than this will be rejected to prevent replay attacks
WEBHOOK_SIGNATURE_TOLERANCE=300

# ============================================================================
# NOTIFICATION QUEUE CONFIGURATION
# ============================================================================

# [OPTIONAL] Maximum concurrent notification jobs
# MAX_CONCURRENT_NOTIFICATIONS=10

# [OPTIONAL] Notification retry attempts
# MAX_RETRY_ATTEMPTS=3

# [OPTIONAL] Delay between retries in milliseconds
# RETRY_DELAY=60000

# [OPTIONAL] Enable notification batching for bulk sends
# ENABLE_BATCHING=true

# [OPTIONAL] Batch size for bulk notifications
# BATCH_SIZE=100

# ============================================================================
# NOTIFICATION PREFERENCES
# ============================================================================

# [OPTIONAL] Default notification channels (comma-separated)
# Values: email, push, sms
# DEFAULT_CHANNELS=email,push

# [OPTIONAL] Enable real-time WebSocket notifications
# WEBSOCKET_ENABLED=true

# [OPTIONAL] WebSocket server port (if separate from main service)
# WS_PORT=4006

# ============================================================================
# TEMPLATES
# ============================================================================

# [OPTIONAL] Email template directory
# TEMPLATES_DIR=./templates

# [OPTIONAL] Enable HTML email templates
# HTML_EMAILS=true

# ============================================================================
# NOTES
# ============================================================================
# 1. Never commit .env files with real credentials to version control
# 2. For local email testing, use MailHog (docker run -p 1025:1025 -p 8025:8025 mailhog/mailhog)
#    - SMTP: localhost:1025
#    - Web UI: http://localhost:8025
# 3. Firebase setup:
#    - Create project at https://console.firebase.google.com
#    - Enable Cloud Messaging
#    - Generate service account key (Project Settings > Service Accounts)
# 4. APNs setup:
#    - Create key at https://developer.apple.com/account/resources/authkeys/list
#    - Download .p8 file
#    - Note the Key ID and Team ID
# 5. For production:
#    - Use Azure Key Vault for secret management
#    - Use managed email services (SendGrid, Mailgun) for deliverability
#    - Configure SPF, DKIM, and DMARC for email domain
# ============================================================================

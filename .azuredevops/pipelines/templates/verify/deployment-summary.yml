# ============================================================================
# Template: Deployment Summary
# ============================================================================
parameters:
  - name: semanticVersion
    type: string
  - name: imageTag
    type: string
  - name: buildId
    type: string

steps:
  - script: |
      echo "=============================================="
      echo "    APPLYFORUD DEPLOYMENT SUMMARY"
      echo "=============================================="
      echo ""
      echo "Build Information:"
      echo "  Version:      ${{ parameters.semanticVersion }}"
      echo "  Image Tag:    ${{ parameters.imageTag }}"
      echo "  Build ID:     ${{ parameters.buildId }}"
      echo "  Build Number: $(Build.BuildNumber)"
      echo "  Branch:       $(Build.SourceBranchName)"
      echo "  Commit:       $(Build.SourceVersion)"
      echo "  Triggered By: $(Build.RequestedFor)"
      echo "  Date:         $(date -u +%Y-%m-%dT%H:%M:%SZ)"
      echo ""
      echo "Pipeline Stages:"
      echo "  A. Build & Test      - Completed"
      echo "  B. Container Push    - Completed"
      echo "  C. Deploy Dev        - Checked"
      echo "  D. Deploy Test       - Checked"
      echo "  E. Deploy Prod       - Checked"
      echo "  F. Post-Deployment   - Running"
      echo ""
      echo "Container Registry: applyforusacr.azurecr.io"
      echo ""
      echo "Docker Images:"
      echo "  - applyai-web:${{ parameters.imageTag }}"
      echo "  - applyai-auth-service:${{ parameters.imageTag }}"
      echo "  - applyai-user-service:${{ parameters.imageTag }}"
      echo "  - applyai-job-service:${{ parameters.imageTag }}"
      echo "  - applyai-resume-service:${{ parameters.imageTag }}"
      echo "  - applyai-notification-service:${{ parameters.imageTag }}"
      echo "  - applyai-auto-apply-service:${{ parameters.imageTag }}"
      echo "  - applyai-analytics-service:${{ parameters.imageTag }}"
      echo "  - applyai-ai-service:${{ parameters.imageTag }}"
      echo "  - applyai-orchestrator-service:${{ parameters.imageTag }}"
      echo ""
      echo "=============================================="
      echo "    DEPLOYMENT COMPLETED SUCCESSFULLY"
      echo "=============================================="
    displayName: 'Print Deployment Summary'

  - script: |
      mkdir -p $(Build.ArtifactStagingDirectory)/summary

      cat > $(Build.ArtifactStagingDirectory)/summary/deployment-report.md << EOF
      # ApplyForUs Deployment Report

      ## Build Information

      | Property | Value |
      |----------|-------|
      | Version | ${{ parameters.semanticVersion }} |
      | Image Tag | ${{ parameters.imageTag }} |
      | Build ID | ${{ parameters.buildId }} |
      | Branch | $(Build.SourceBranchName) |
      | Commit | $(Build.SourceVersion) |
      | Date | $(date -u +%Y-%m-%dT%H:%M:%SZ) |

      ## Stages Executed

      - A. Build & Test
      - B. Container Push
      - C. Deploy to Dev
      - D. Deploy to Test
      - E. Deploy to Prod
      - F. Post-Deployment

      ---
      *Generated by ApplyForUs Unified Pipeline*
      EOF
    displayName: 'Generate Report'

  - task: PublishPipelineArtifact@1
    displayName: 'Publish Summary'
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)/summary'
      artifact: 'deployment-summary-${{ parameters.buildId }}'
      publishLocation: 'pipeline'

# ============================================================================
# SERVICE ACCOUNTS FOR APPLYFORUS SERVICES
# ============================================================================
# Each service gets its own ServiceAccount for fine-grained RBAC
# Integrated with Azure Workload Identity for managed identity access
# ============================================================================

# Main application service account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: applyforus-sa
  namespace: applyforus
  labels:
    app.kubernetes.io/part-of: applyforus
  annotations:
    azure.workload.identity/client-id: "${WORKLOAD_IDENTITY_CLIENT_ID}"
    azure.workload.identity/tenant-id: "${AZURE_TENANT_ID}"
automountServiceAccountToken: false
---
# Auth service account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: auth-service-sa
  namespace: applyforus
  labels:
    app.kubernetes.io/name: auth-service
    app.kubernetes.io/part-of: applyforus
  annotations:
    azure.workload.identity/client-id: "${WORKLOAD_IDENTITY_CLIENT_ID}"
automountServiceAccountToken: false
---
# Job service account (needs job board API access)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: job-service-sa
  namespace: applyforus
  labels:
    app.kubernetes.io/name: job-service
    app.kubernetes.io/part-of: applyforus
  annotations:
    azure.workload.identity/client-id: "${WORKLOAD_IDENTITY_CLIENT_ID}"
automountServiceAccountToken: false
---
# AI service account (needs AI API access)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: ai-service-sa
  namespace: applyforus
  labels:
    app.kubernetes.io/name: ai-service
    app.kubernetes.io/part-of: applyforus
  annotations:
    azure.workload.identity/client-id: "${WORKLOAD_IDENTITY_CLIENT_ID}"
automountServiceAccountToken: false
---
# Payment service account (needs Stripe access)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: payment-service-sa
  namespace: applyforus
  labels:
    app.kubernetes.io/name: payment-service
    app.kubernetes.io/part-of: applyforus
  annotations:
    azure.workload.identity/client-id: "${WORKLOAD_IDENTITY_CLIENT_ID}"
automountServiceAccountToken: false
---
# Auto-apply service account (needs browser automation)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: auto-apply-service-sa
  namespace: applyforus
  labels:
    app.kubernetes.io/name: auto-apply-service
    app.kubernetes.io/part-of: applyforus
  annotations:
    azure.workload.identity/client-id: "${WORKLOAD_IDENTITY_CLIENT_ID}"
automountServiceAccountToken: false

apiVersion: v1
kind: Secret
metadata:
  name: applyforus-secrets
  namespace: applyforus
  labels:
    app: applyforus-platform
type: Opaque
stringData:
  # Database Credentials
  # Values should be synced from Azure Key Vault using Azure Key Vault Provider for Secrets Store CSI Driver
  POSTGRES_USER: "<SYNC_FROM_KEY_VAULT>"
  POSTGRES_PASSWORD: "<SYNC_FROM_KEY_VAULT>"

  # Redis Credentials
  REDIS_PASSWORD: "<SYNC_FROM_KEY_VAULT>"

  # JWT Secrets
  JWT_SECRET: "<SYNC_FROM_KEY_VAULT>"
  JWT_REFRESH_SECRET: "<SYNC_FROM_KEY_VAULT>"

  # Azure Storage
  AZURE_STORAGE_CONNECTION_STRING: "<SYNC_FROM_KEY_VAULT>"
  AZURE_STORAGE_ACCOUNT_KEY: "<SYNC_FROM_KEY_VAULT>"

  # Azure OpenAI
  AZURE_OPENAI_API_KEY: "<SYNC_FROM_KEY_VAULT>"

  # Email Credentials
  SMTP_USERNAME: "<SYNC_FROM_KEY_VAULT>"
  SMTP_PASSWORD: "<SYNC_FROM_KEY_VAULT>"

  # OAuth Credentials
  GOOGLE_CLIENT_ID: "<SYNC_FROM_KEY_VAULT>"
  GOOGLE_CLIENT_SECRET: "<SYNC_FROM_KEY_VAULT>"
  LINKEDIN_CLIENT_ID: "<SYNC_FROM_KEY_VAULT>"
  LINKEDIN_CLIENT_SECRET: "<SYNC_FROM_KEY_VAULT>"

  # Encryption Keys
  ENCRYPTION_KEY: "<SYNC_FROM_KEY_VAULT>"

  # Third-party API Keys
  SENDGRID_API_KEY: "<SYNC_FROM_KEY_VAULT>"

---
# Azure Key Vault Secret Provider Class
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: applyforus-azure-keyvault
  namespace: applyforus
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "<AZURE_MANAGED_IDENTITY_CLIENT_ID>"
    keyvaultName: "jobpilot-keyvault"
    cloudName: "AzurePublicCloud"
    objects: |
      array:
        - |
          objectName: postgres-user
          objectType: secret
          objectAlias: POSTGRES_USER
        - |
          objectName: postgres-password
          objectType: secret
          objectAlias: POSTGRES_PASSWORD
        - |
          objectName: redis-password
          objectType: secret
          objectAlias: REDIS_PASSWORD
        - |
          objectName: jwt-secret
          objectType: secret
          objectAlias: JWT_SECRET
        - |
          objectName: jwt-refresh-secret
          objectType: secret
          objectAlias: JWT_REFRESH_SECRET
        - |
          objectName: azure-storage-connection-string
          objectType: secret
          objectAlias: AZURE_STORAGE_CONNECTION_STRING
        - |
          objectName: azure-openai-api-key
          objectType: secret
          objectAlias: AZURE_OPENAI_API_KEY
        - |
          objectName: smtp-username
          objectType: secret
          objectAlias: SMTP_USERNAME
        - |
          objectName: smtp-password
          objectType: secret
          objectAlias: SMTP_PASSWORD
        - |
          objectName: google-client-id
          objectType: secret
          objectAlias: GOOGLE_CLIENT_ID
        - |
          objectName: google-client-secret
          objectType: secret
          objectAlias: GOOGLE_CLIENT_SECRET
        - |
          objectName: linkedin-client-id
          objectType: secret
          objectAlias: LINKEDIN_CLIENT_ID
        - |
          objectName: linkedin-client-secret
          objectType: secret
          objectAlias: LINKEDIN_CLIENT_SECRET
        - |
          objectName: encryption-key
          objectType: secret
          objectAlias: ENCRYPTION_KEY
        - |
          objectName: sendgrid-api-key
          objectType: secret
          objectAlias: SENDGRID_API_KEY
    tenantId: "<AZURE_TENANT_ID>"
  secretObjects:
  - secretName: applyforus-secrets
    type: Opaque
    data:
    - objectName: POSTGRES_USER
      key: POSTGRES_USER
    - objectName: POSTGRES_PASSWORD
      key: POSTGRES_PASSWORD
    - objectName: REDIS_PASSWORD
      key: REDIS_PASSWORD
    - objectName: JWT_SECRET
      key: JWT_SECRET
    - objectName: JWT_REFRESH_SECRET
      key: JWT_REFRESH_SECRET
    - objectName: AZURE_STORAGE_CONNECTION_STRING
      key: AZURE_STORAGE_CONNECTION_STRING
    - objectName: AZURE_OPENAI_API_KEY
      key: AZURE_OPENAI_API_KEY
    - objectName: SMTP_USERNAME
      key: SMTP_USERNAME
    - objectName: SMTP_PASSWORD
      key: SMTP_PASSWORD
    - objectName: GOOGLE_CLIENT_ID
      key: GOOGLE_CLIENT_ID
    - objectName: GOOGLE_CLIENT_SECRET
      key: GOOGLE_CLIENT_SECRET
    - objectName: LINKEDIN_CLIENT_ID
      key: LINKEDIN_CLIENT_ID
    - objectName: LINKEDIN_CLIENT_SECRET
      key: LINKEDIN_CLIENT_SECRET
    - objectName: ENCRYPTION_KEY
      key: ENCRYPTION_KEY
    - objectName: SENDGRID_API_KEY
      key: SENDGRID_API_KEY

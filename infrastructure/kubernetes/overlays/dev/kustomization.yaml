apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: applyforus-dev

namePrefix: dev-

bases:
- ../../base
- ../../services

commonLabels:
  environment: development
  app.kubernetes.io/environment: dev

commonAnnotations:
  environment: development

# Replica overrides for dev environment
replicas:
- name: auth-service
  count: 1
- name: user-service
  count: 1
- name: job-service
  count: 1
- name: ai-service
  count: 1
- name: resume-service
  count: 1
- name: analytics-service
  count: 1
- name: notification-service
  count: 1
- name: auto-apply-service
  count: 1
- name: orchestrator-service
  count: 1
- name: web-app
  count: 1

# Image tag overrides
images:
- name: ${ACR_LOGIN_SERVER}/auth-service
  newName: applyforusacr.azurecr.io/auth-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/user-service
  newName: applyforusacr.azurecr.io/user-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/job-service
  newName: applyforusacr.azurecr.io/job-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/ai-service
  newName: applyforusacr.azurecr.io/ai-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/resume-service
  newName: applyforusacr.azurecr.io/resume-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/analytics-service
  newName: applyforusacr.azurecr.io/analytics-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/notification-service
  newName: applyforusacr.azurecr.io/notification-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/auto-apply-service
  newName: applyforusacr.azurecr.io/auto-apply-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/orchestrator-service
  newName: applyforusacr.azurecr.io/orchestrator-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/payment-service
  newName: applyforusacr.azurecr.io/payment-service
  newTag: dev
- name: ${ACR_LOGIN_SERVER}/web-app
  newName: applyforusacr.azurecr.io/web-app
  newTag: dev

# ConfigMap overrides for dev environment
configMapGenerator:
- name: applyforus-config
  behavior: merge
  literals:
  - NODE_ENV=development
  - LOG_LEVEL=debug
  - CORS_ORIGIN=http://localhost:3000,http://localhost:3001

# Resource adjustments for dev (reduced limits)
patches:
- target:
    kind: Deployment
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: 500m
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: 512Mi

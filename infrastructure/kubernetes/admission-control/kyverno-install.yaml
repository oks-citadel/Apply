# ==============================================================================
# KYVERNO INSTALLATION CONFIGURATION
# ==============================================================================
# Kyverno is a policy engine designed for Kubernetes
# This file provides Helm values for installing Kyverno via Helm chart
# ==============================================================================
#
# Installation Commands:
#
# 1. Add the Kyverno Helm repository:
#    helm repo add kyverno https://kyverno.github.io/kyverno/
#    helm repo update
#
# 2. Install Kyverno with these values:
#    helm install kyverno kyverno/kyverno #      --namespace kyverno #      --create-namespace #      --values kyverno-install.yaml
#
# 3. Verify installation:
#    kubectl get pods -n kyverno
#    kubectl get clusterpolicies
#
# ==============================================================================

namespace: kyverno

admissionController:
  replicas: 3
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 256Mi
  podDisruptionBudget:
    enabled: true
    minAvailable: 1
  serviceAccount:
    create: true
    name: kyverno-admission-controller
  securityContext:
    runAsNonRoot: true
    runAsUser: 65534
    seccompProfile:
      type: RuntimeDefault
  container:
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
  nodeSelector:
    kubernetes.io/os: linux
  tolerations:
    - key: CriticalAddonsOnly
      operator: Exists
  antiAffinity:
    enabled: true
    topologyKey: kubernetes.io/hostname

backgroundController:
  replicas: 2
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

cleanupController:
  replicas: 1
  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

reportsController:
  replicas: 1
  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

webhooks:
  failurePolicy: Fail
  timeoutSeconds: 10

features:
  policyReports:
    enabled: true
  admissionReports:
    enabled: true
  backgroundScan:
    enabled: true
    backgroundScanInterval: 1h

metricsService:
  enabled: true
  port: 8000
  annotations:
    prometheus.io/scrape: 'true'
    prometheus.io/port: '8000'

config:
  resourceFilters:
    - '[Event,*,*]'
    - '[*,kube-system,*]'
    - '[*,kube-public,*]'
    - '[*,kube-node-lease,*]'
    - '[*,kyverno,*]'
    - '[Node,*,*]'
    - '[APIService,*,*]'
    - '[TokenReview,*,*]'
    - '[SubjectAccessReview,*,*]'

networkPolicy:
  enabled: true

podSecurityStandard:
  enabled: true
  level: restricted

logging:
  format: json
  verbosity: 2
